# 🚀 浏览器历史记录本地API服务

## 📋 功能特点

- ✅ **增量存储**: 自动去重，只存储新的历史记录
- ✅ **批量同步**: 支持一次性同步大量历史记录
- ✅ **SQLite数据库**: 轻量级本地数据库存储
- ✅ **RESTful API**: 标准HTTP接口，易于扩展
- ✅ **统计信息**: 提供同步统计和数据分析
- ✅ **CORS支持**: 允许Chrome扩展跨域访问

## 🛠️ 安装和启动

### 1. 安装Python依赖

```bash
# 进入项目目录
cd C:\Users\charlie\Desktop\google_fav

# 安装依赖
pip install -r requirements.txt
```

### 2. 启动API服务

```bash
# 启动服务
python server.py
```

启动成功后会看到：
```
🚀 启动浏览器历史记录本地API服务
📊 服务地址: http://localhost:8000
📚 API文档: http://localhost:8000/docs
📈 ReDoc文档: http://localhost:8000/redoc
==================================================
```

### 3. 使用Chrome扩展同步

1. **重新加载扩展**: 在 `chrome://extensions/` 中重新加载插件
2. **点击插件图标**: 打开历史记录查看器
3. **点击"同步到本地"**: 将当前筛选的历史记录同步到本地数据库

## 📊 API接口说明

### 基础接口
- `GET /` - API服务状态
- `GET /docs` - Swagger API文档
- `GET /redoc` - ReDoc API文档

### 同步接口
- `POST /sync-single` - 同步单条历史记录
- `POST /sync-batch` - 批量同步历史记录

### 查询接口
- `GET /stats` - 获取统计信息
- `GET /history` - 获取历史记录列表

## 💾 数据库结构

SQLite数据库 `browser_history.db` 包含以下表：

### browser_history 表
```sql
CREATE TABLE browser_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    url TEXT NOT NULL,                    -- 网址
    title TEXT,                          -- 标题
    visit_time INTEGER NOT NULL,         -- 访问时间(Unix时间戳)
    visit_count INTEGER DEFAULT 1,       -- 访问次数
    first_visit_time INTEGER NOT NULL,   -- 首次访问时间
    last_visit_time INTEGER NOT NULL,    -- 最后访问时间
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(url, visit_time)              -- 防重复约束
);
```

### sync_stats 表
```sql
CREATE TABLE sync_stats (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    total_synced INTEGER DEFAULT 0,      -- 总同步数量
    last_sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    sync_count INTEGER DEFAULT 0         -- 同步次数
);
```

## 🔧 使用示例

### 1. 检查服务状态
```bash
curl http://localhost:8000/
```

### 2. 获取统计信息
```bash
curl http://localhost:8000/stats
```

### 3. 查询历史记录
```bash
# 获取最新100条记录
curl "http://localhost:8000/history?limit=100"

# 搜索包含"github"的记录
curl "http://localhost:8000/history?search=github"
```

### 4. 手动同步单条记录
```bash
curl -X POST "http://localhost:8000/sync-single" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://github.com",
    "title": "GitHub",
    "visitTime": 1704067200000,
    "visitCount": 5
  }'
```

## 📈 监控和维护

### 查看数据库文件
数据库文件位置: `browser_history.db`

可以使用SQLite客户端工具查看：
```bash
# 使用sqlite3命令行工具
sqlite3 browser_history.db

# 查看所有表
.tables

# 查看记录数量
SELECT COUNT(*) FROM browser_history;

# 查看最近的同步统计
SELECT * FROM sync_stats ORDER BY id DESC LIMIT 1;
```

### 日志查看
服务运行时会输出详细日志，包括：
- 数据库操作日志
- API请求日志
- 错误信息

## ⚠️ 注意事项

1. **端口占用**: 确保8000端口没有被其他程序占用
2. **CORS配置**: 当前配置允许所有来源访问，生产环境请限制具体域名
3. **数据备份**: 定期备份 `browser_history.db` 文件
4. **权限要求**: 确保有读写当前目录的权限

## 🚀 启动快捷方式

创建批处理文件 `start_server.bat`:
```batch
@echo off
cd /d "C:\Users\charlie\Desktop\google_fav"
python server.py
pause
```

双击即可启动服务！

## 🎯 下一步扩展

- [ ] 添加Web管理界面
- [ ] 支持数据导出/导入
- [ ] 添加访问频率分析
- [ ] 支持标签和分类
- [ ] 添加全文搜索功能